FOR CYBERCLAW - CHANGES LOG & NOTES
=====================================

LATEST UPDATE: 2026-02-17 — MOBILE LAYOUT + BACKDROP IMAGES
-------------------------------------------------------------

Hey Cyberclaw, Josh asked me to fix the mobile layout. On phones, the
side-by-side poster+card layout was too cramped — the poster and card were
fighting for horizontal space and everything looked tiny.

WHAT I DID:
1. Added TMDB backdrop images (widescreen 16:9 banners) to all show data.
   - Used scripts/fetch-backdrops.js to fetch from TMDB API
   - 75 out of 102 shows have backdrop URLs
   - 27 shows have no backdrop available (they fall back to a blurred poster)
   - New field: "backdrop" on every show in index.json and FALLBACK_SHOWS

2. Added mobile responsive layout (CSS media query at max-width: 600px):
   - On mobile: cards switch from HORIZONTAL (poster left, card right)
     to VERTICAL (backdrop banner on top, card panel below)
   - The poster is hidden on mobile (display:none)
   - A new .show-backdrop div shows the widescreen banner image instead
   - Shows without backdrops fall back to their poster image (blurred + dimmed)
   - Shows with no images at all get a gradient with the first letter
   - The rank badge moves to the backdrop area on mobile
   - Card panel gets full width with rounded bottom corners

3. Added .show-backdrop CSS class:
   - Hidden by default (desktop shows poster as before)
   - Shown on mobile: 180px tall, full width, object-fit:cover
   - Has a gradient overlay at the bottom for smooth transition to card
   - Search in CSS for ".show-backdrop" to find all the styles

FILES CHANGED:
  - index.html — added backdrop banner to card template, added mobile CSS
  - data/shows/index.json — added "backdrop" field to all 102 shows

TO PUSH LIVE: Push both index.html and data/shows/index.json.

IMPORTANT NOTES:
- The .show-backdrop div is in the card template (renderShows function, ~line 3714)
- It's hidden on desktop (display:none by default) — desktop layout is unchanged
- On mobile (<=600px) it becomes visible and the poster hides
- If you need to re-fetch backdrops: node scripts/fetch-backdrops.js
- The fallback for missing backdrops uses the poster with blur(2px) + brightness(0.7)

---

PREVIOUS UPDATE: 2026-02-17 — MASTER LIST SYNC FIX
--------------------------------------------------

Hey Cyberclaw, Josh asked me (Claude Opus) to fix the rankings because they
didn't match the master list. Here's exactly what was wrong and what I fixed.


WHAT WAS WRONG:
===============

1. THE RANKINGS WERE NOT MATCHING THE MASTER LIST
   The source of truth is: docs/top100currentdefault.md
   But index.json and the FALLBACK_SHOWS in index.html had different ranks,
   different scores, and even different shows. Almost every show was in the
   wrong position.

2. EXTRA SHOW: "Pluribus" (was rank 31 in index.json)
   This show is NOT in the master list. It should not be on the site.
   I removed it.

3. TITLE ENCODING: "Shogun (2024)" was stored with corrupted characters
   somewhere in the pipeline — showed up as "ShÅgun (2024)" in some contexts.
   Fixed to plain ASCII "Shogun (2024)".

4. TITLE MISMATCHES:
   - "BEEF" should be "Beef" (case)
   - "True Detective: Season 3" should be "True Detective S3" (naming convention)

5. SCORE MISMATCHES:
   Every show had scores that didn't match the master list. For example:
   - GoT was final: 9.53 in index.json, should be 9.45
   - Breaking Bad was final: 8.95, should be 8.80
   - Band of Brothers wasn't even in the top 10, should be rank 3
   This was likely caused by rebuilding the index with different weights or
   without applying the current weight configuration (25/15/5/5/15/15/20).

6. RANK 24 GAP:
   The master list skips rank 24 (goes 23 → 25). This is intentional.
   There are 102 shows total, ranked 1-103 with 24 missing.


WHAT I FIXED:
=============

Files changed:
  - data/shows/index.json — rebuilt with all 102 shows matching master list
  - index.html — FALLBACK_SHOWS array replaced with corrected 102 shows

What I preserved from the old data:
  - All poster URLs
  - All streaming availability (US/UK)
  - All TMDB IDs
  - All slugs
  - All month data (master list only has years)

What came from the master list (source of truth):
  - Ranks
  - Titles
  - Years
  - Episode counts
  - All 7 category scores (char, world, cine, spect, conc, drive, resol)
  - Final scores
  - Genres

Tool used: scripts/sync-master.js
  - This script reads the master list data (hardcoded from docs/top100currentdefault.md)
  - Merges with metadata from the old index.json
  - Outputs corrected index.json and FALLBACK_OUTPUT.txt
  - Run with: node scripts/sync-master.js
  - You can re-run this anytime to re-sync if data drifts


HOW TO AVOID THIS IN THE FUTURE:
=================================

1. NEVER regenerate index.json by recalculating scores from scratch.
   The master list (docs/top100currentdefault.md) has the FINAL scores.
   Use those directly.

2. If you need to rebuild index.json, use scripts/sync-master.js.
   It pulls scores from the master list and metadata from existing data.

3. Don't add shows that aren't in the master list. If Josh wants to add
   a show, it goes in the master list FIRST, then gets synced to the site.

4. The default weights in index.html are 25/15/5/5/15/15/20.
   These match the master list. Don't change them without updating the
   master list too.

5. Watch out for title encoding — use plain ASCII for all titles.
   No special characters in show names unless absolutely necessary.


ALSO FIXED: RANK BADGE SHOWING WRONG NUMBERS (2026-02-17)
-----------------------------------------------------------

The rank badge (top-left corner of poster) was using:
  filtered.findIndex(s => s.title === show.title) + 1

This calculates the show's POSITION in the filtered array, NOT its actual rank.
That's wrong — it should use show.rank directly.

Fixed to: show.rank

Line ~3672 in index.html.

NOTE FOR CYBERCLAW: Don't use findIndex for rank display. The rank is already
stored on each show object. Just use show.rank.


PREVIOUS CHANGES (2026-02-15):
==============================

FEATURE: Per-Category Score Sliders on Every Show Card
- Every category bar has a range slider overlaid on it (0-10, step 0.5)
- Live score/ranking updates while dragging
- Modified values show blue tint (#60a5fa)
- Fixed bottom save bar with Save/Export/Import/Reset
- localStorage persistence (tvranked_score_overrides key)
- JSON export/import for portability
- recalcFinal(show) is the shared calculation formula
- Pinned shows stored by title (not rank, since ranks are mutable)

---
This doc will be updated whenever changes are made from this end.
Push both index.html and data/shows/index.json to make this live.
